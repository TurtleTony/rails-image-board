<% @title = "Post" %>
<%= csrf_meta_tag %>

<%= javascript_tag do %>
  post_id = <%= @post.id %>
<% end %>
<div class="text-center position-relative">
  <%= image_tag @post.resource, class: "img-fluid" %>
  <%= link_to(@post.resource, class: "position-absolute enhance-link p-3", target: "_blank") do
    icon('fas', 'search-plus', class: "fa-2x")
  end %>
</div>

<span class="row">
  <span class="col-3" style="font-size: 2.5rem; line-height: 1.2">
    <span>
    <% if user_signed_in? %>
      <% has_voted = Vote.voted_on_by(@post.id, current_user.id) %>
      <span class="" style=""><%= link_to("#", onclick: "vote(true," + @post.id.to_s + ")", class: "upvote", id: "upvote"+@post.id.to_s, data: { turbolinks: false }, remote: true ) do %><%= icon('fas', 'caret-square-up', class: "fa-1x " + (has_voted == 1 ? "text-warning" : ""), id: "upvoteicon") %><% end %></span>
    <% end %>
    <span class="position-absolute" style="top: .5em; left: 1.5em; right: 0; bottom: 0">
      <%= content_tag(:div, content_tag(:div, @post.calculate_upvotes, id: "votes" + @post.id.to_s), id: "vote") %>
    </span>
      <br>
    <% if user_signed_in? %>
      <% has_voted = Vote.voted_on_by(@post.id, current_user.id) %>
      <span class=""><%= link_to("#", onclick: "vote(false," + @post.id.to_s + ")", class: "downvote", id: "downvote"+@post.id.to_s, data: { turbolinks: false }, remote: true ) do %><%= icon('fas', 'caret-square-down', class: "fa-1x " + (has_voted == -1 ? "text-warning" : ""), id: "downvoteicon") %><% end %></span>
    <% end %>
  </span>
  </span>
  <span class="col">
    <span class="text-light">Posted to
      <span class="badge badge-danger"><%= @post.filter %></span>
        <%= render 'shared/timestamp', timestamp: @post.created_at %>
        by <%= render 'users/user_link', user: @post.user %>
      </span>
    <%= link_to "Delete", post_path(@post), method: :delete, data: {confirm: "Are you sure?"} if user_signed_in? if @deletable %>
    <%= render 'shared/tag_list', id: "tags", values: @post.tags %>
  </span>
</span>


<div class="mt-3 text-light">
  <h4><%= @post.comments.size %> Comments</h4>

  <%= render 'comments/new', post_id: @post.id %>
  <div class="mt-3">
    <%= render 'comments/index', comments: @post.comments.where(comment_id: nil), post: @post %>
  </div>
</div>